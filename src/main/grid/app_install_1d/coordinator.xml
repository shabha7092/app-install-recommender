<coordinator-app name="app_install_1d" frequency="${coord:days(1)}" start="${start_time}" end="${end_time}" timezone="${timezone}" xmlns="uri:oozie:coordinator:0.4">
        <controls>
                <timeout>180</timeout>
                <concurrency>10</concurrency>
                <execution>FIFO</execution>
        </controls>

        <datasets>
                <dataset name="impression_data" frequency="${coord:minutes(15)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${ImpressionDataRoot}/${YEAR}${MONTH}${DAY}${HOUR}${MINUTE}</uri-template>
                        <done-flag>_SUCCESS</done-flag>
                </dataset>
           
                <dataset name="click_data" frequency="${coord:minutes(15)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${ClickDataRoot}/${YEAR}${MONTH}${DAY}${HOUR}${MINUTE}</uri-template>
                        <done-flag>_SUCCESS</done-flag>
                </dataset>
              
                <dataset name="conversion_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${ConversionDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
               
                <dataset name="user_engagement_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
			<uri-template>${engagementDataRoot}/date=${YEAR}${MONTH}${DAY}</uri-template>
                        <done-flag/>
		</dataset>
                <dataset name="app_install_model_config" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallConfigRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                        <done-flag>model_config.json</done-flag>
                </dataset>
                <dataset name="app_install_impression_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallImpressionDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
                <dataset name="app_install_click_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallClickDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
                <dataset name="app_install_conversion_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallConversionDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
                <dataset name="mapped_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${mappedDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
                 <dataset name="app_install_label_data" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallLabelDataRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
                <dataset name="app_install_model" frequency="${coord:days(1)}" initial-instance="${ds_start_time}" timezone="${timezone}">
                        <uri-template>${appInstallModelRoot}/${YEAR}${MONTH}${DAY}</uri-template>
                </dataset>
        </datasets>
       
        <input-events>
                <data-in name="impression_data_in" dataset="impression_data">
                        <start-instance>${coord:current(-95)}</start-instance>
                        <end-instance>${coord:current(0)}</end-instance>
                </data-in>
                <data-in name="click_data_in" dataset="click_data">
                        <start-instance>${coord:current(-95)}</start-instance>
                        <end-instance>${coord:current(0)}</end-instance>
                </data-in>
                <data-in name="conversion_data_in" dataset="onversion_data">
                        <start-instance>${coord:current(-1)}</start-instance>
                        <end-instance>${coord:current(0)}</end-instance>
                </data-in>
                
                <data-in name="user_engagement_data_in" dataset="user_engagement_data">
		        <start-instance>${coord:current(-30)}</start-instance>
                        <end-instance>${coord:current(0)}</end-instance>
                </data-in>
                <data-in name="model_config_in" dataset="app_install_model_config">
                         <instance>${coord:latest(0)}</instance>
                </data-in>
        </input-events>

        <output-events>
                <data-out name="impression_data_out" dataset="app_install_impression_data">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
                <data-out name="click_data_out" dataset="app_install_click_data">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
                <data-out name="conversion_data_out" dataset="app_install_conversion_data">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
                <data-out name="mapped_data_out" dataset="mapped_data">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
                <data-out name="label_data_out" dataset="app_install_label_data">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
                <data-out name="app_install_model_out" dataset="app_install_model">
                            <instance>${coord:current(-1)}</instance>
                </data-out>
        </output-events>

        <action>
                <workflow>
                        <app-path>${nameNode}${appRoot}/</app-path>
                        <configuration>
                                <property>
                                        <name>IMPRESSION_DATA</name>
                                        <value>${coord:dataIn('impression_data_in')}</value>
                                </property>
                                <property>
                                        <name>GEMINI_CLICK_DATA</name>
                                        <value>${coord:dataIn('click_data_in')}</value>
                                </property>
                                <property>
                                          <name>CONVERSION_DATA</name>
                                          <value>${coord:dataIn('conversion_data_in')}</value>
                                </property>
                                <property>
                                          <name>USER_ENGAGEMENT_DATA</name>
                                          <value>${coord:dataIn('user_engagement_data_in')}</value>
                                </property>

                                 <property>
                                        <name>APP_INSTALL_MODEL_CONFIG</name>
                                        <value>${coord:dataIn('model_config_in')}</value>
                                </property>

                                <property>
                                          <name>APP_INSTALL_IMPRESSION_DATA</name>
                                          <value>${coord:dataOut('impression_data_out')}</value>
                                </property>
                                <property>
                                          <name>APP_INSTALL_CLICK_DATA</name>
                                          <value>${coord:dataOut('click_data_out')}</value>
                                </property>
                                <property>
                                          <name>APP_INSTALL_CONVERSION_DATA</name>
                                          <value>${coord:dataOut('conversion_data_out')}</value>
                                </property>
                                <property>
                                          <name>MAPPED_DATA</name>
                                          <value>${coord:dataOut('mapped_data_out')}</value>
                                </property>
                                 <property>
                                          <name>APP_INSTALL_LABEL_DATA</name>
                                          <value>${coord:dataOut('label_data_out')}</value>
                                 </property>
                                 <property>
                                          <name>APP_INSTALL_MODEL</name>
                                          <value>${coord:dataOut('app_install_model_out')}</value>
                                 </property>
                                <property>
                                          <name>CONVERSION_FILTER_START_DATE</name>
                                          <value>${coord:formatTime(coord:dateOffset(coord:nominalTime(),-1,'DAY'),"yyyy-MM-dd'T'HH:mm:ss.SSSZ")}</value>
                                </property>
                                <property>
                                          <name>CONVERSION_FILTER_END_DATE</name>
                                          <value>${coord:formatTime(coord:dateOffset(coord:nominalTime(),0,'DAY'),"yyyy-MM-dd'T'HH:mm:ss.SSSZ")}</value>
                                </property>
                                <property>
                                          <name>MACRO_PATH</name>
                                          <value>${macroRoot}</value>
                                </property>
                                <property>
                                          <name>PROCESS_TIME</name>
                                          <value>${coord:formatTime(coord:dateOffset(coord:nominalTime(),0,'DAY'),'yyyyMMdd')}</value>
                                </property>
                         </configuration>
                </workflow>
        </action>
</coordinator-app>
